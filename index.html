<!doctype html>
<meta charset="utf-8">
<title>Impact</title>

<style>
article { border-bottom: 5px solid #aef; padding: 10px; clear: both; overflow: auto; }
div { padding: 10px; }
</style>

<div id="metrics"></div>

<script>
var fetchCitation = function(doi, container) {
	var xhr = new XMLHttpRequest;
	xhr.open("GET", "http://data.crossref.org/" + doi);
	xhr.setRequestHeader("Accept", "text/bibliography; style=apa; locale=en-US");
	xhr.onload = function() {
		container.textContent = this.response;
	};
	xhr.send();
};

var container = document.getElementById("metrics");

for (var i = 1; i < 50; i++) {
	var doi = "10.7717/peerj." + i;

	var itemContainer = document.createElement("article");

	var a = document.createElement("a");
	a.textContent = doi;
	a.setAttribute("href", "http://dx.doi.org/" + doi);

	var header = document.createElement("h2");
	header.appendChild(a);
	itemContainer.appendChild(header);

	var bib = document.createElement("div");
	itemContainer.appendChild(bib);

	fetchCitation(doi, bib);

	var item = document.createElement("div");

	item.setAttribute("class", "altmetric-embed");
	item.setAttribute("data-badge-type", "large-donut");
	item.setAttribute("data-badge-details", "right");
	item.setAttribute("data-doi", doi);
	
	itemContainer.appendChild(item);

	var item = document.createElement("div");

	item.setAttribute("class", "impactstory-embed");
	item.setAttribute("data-verbose-badges", "true");
	item.setAttribute("data-id-type", "doi");
	item.setAttribute("data-api-key", "eaton-0w99ho");
	item.setAttribute("data-id", doi);
	
	itemContainer.appendChild(item);

	container.appendChild(itemContainer);
}
</script>

<script src="http://impactstory.org/embed/v1/impactstory.js"></script>
<script src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script>
